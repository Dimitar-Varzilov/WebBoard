<div
  class="card h-100 job-card"
  [class.border-warning]="job.status === 1"
  [class.border-success]="job.status === 2"
>
  <!-- SignalR Connection Indicator -->
  <div class="position-absolute top-0 end-0 p-2">
    <i
      *ngIf="isConnected$ | async"
      class="fas fa-circle text-success pulse"
      title="Real-time updates active"
      style="font-size: 8px"
    >
    </i>
    <i
      *ngIf="!(isConnected$ | async)"
      class="fas fa-circle text-muted"
      title="Real-time updates inactive"
      style="font-size: 8px"
    >
    </i>
  </div>

  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <h6 class="card-title mb-0">
        <i class="fas fa-cog me-2"></i>{{ job.jobType }}
      </h6>
      <span class="status-badge ms-2" [ngClass]="getStatusClass(job.status)">{{
        getStatusText(job.status)
      }}</span>
    </div>

    <div class="mb-3">
      <small class="text-muted d-block">
        <i class="fas fa-fingerprint me-1"></i>
        ID: {{ job.id | slice : 0 : 8 }}...
      </small>
      <small class="text-muted d-block">
        <i class="fas fa-calendar me-1"></i>
        Created: {{ job.createdAtCompact }}
      </small>
      <small *ngIf="job.scheduledAt" class="text-muted d-block">
        <i class="fas fa-clock me-1"></i>
        <span [ngClass]="{ 'text-danger': job.isScheduledInPast }">
          Scheduled: {{ job.scheduledAtCompact }}
        </span>
      </small>
      <small *ngIf="job.scheduledAt" class="text-muted d-block">
        <i class="fas fa-hourglass-half me-1"></i>
        {{ job.scheduledAtRelative }}
      </small>
      <small class="text-primary d-block">
        <i class="fas fa-tasks me-1"></i>
        Tasks: {{ job.taskCount }}
      </small>
      <small *ngIf="job.hasReport" class="text-success d-block">
        <i class="fas fa-file-download me-1"></i>
        Report: {{ job.reportFileName }}
      </small>
      <!-- Overdue indicator -->
      <small *ngIf="job.isOverdue" class="text-danger d-block">
        <i class="fas fa-exclamation-triangle me-1"></i>
        Overdue
      </small>
    </div>

    <div class="d-flex justify-content-between align-items-center">
      <div class="progress flex-grow-1 me-2" style="height: 6px">
        <div
          class="progress-bar"
          [ngClass]="getProgressClass(job.status)"
          [style.width.%]="getProgressPercentage(job.status)"
          [class.progress-bar-striped]="job.status === 1"
          [class.progress-bar-animated]="job.status === 1"
        ></div>
      </div>

      <div class="btn-group btn-group-sm">
        <button
          class="btn btn-outline-primary btn-sm"
          (click)="onEdit()"
          [title]="canEdit() ? 'Edit job' : 'Only queued jobs can be edited'"
          [disabled]="!canEdit()"
        >
          <i class="fas fa-edit"></i>
        </button>
        <button
          *ngIf="job.hasReport"
          class="btn btn-outline-success btn-sm"
          (click)="onDownloadReport()"
          [disabled]="isDownloading"
          [title]="'Download report'"
        >
          <i
            class="fas"
            [ngClass]="isDownloading ? 'fa-spinner fa-spin' : 'fa-download'"
          ></i>
        </button>
        <button
          class="btn btn-outline-info btn-sm"
          (click)="onView()"
          [title]="'View job details'"
        >
          <i class="fas fa-eye"></i>
        </button>
        <button
          class="btn btn-outline-danger btn-sm"
          (click)="onDelete()"
          [title]="
            canDelete() ? 'Delete job' : 'Only queued jobs can be deleted'
          "
          [disabled]="!canDelete()"
        >
          <i class="fas fa-trash"></i>
        </button>
        <button
          class="btn btn-outline-secondary btn-sm"
          (click)="onRefresh()"
          [title]="'Refresh status'"
        >
          <i class="fas fa-sync-alt" [class.fa-spin]="isRefreshing"></i>
        </button>
      </div>
    </div>
  </div>
</div>
