<div class="card h-100 task-card">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <h6 class="card-title mb-0 text-truncate" [title]="task.title">
        <i [class]="getStatusIcon(task.status)" [ngClass]="getStatusClass(task.status)" me-2></i>
        {{ task.title }}
      </h6>
      <span class="status-badge ms-2" [ngClass]="getStatusClass(task.status)">{{
        getStatusText(task.status)
      }}</span>
    </div>

    <p class="card-text text-muted small mb-3" [title]="task.description">
      {{ task.description | slice : 0 : 80
      }}{{ task.description.length > 80 ? "..." : "" }}
    </p>

    <div class="mb-2">
      <small class="text-muted d-block">
        <i class="fas fa-calendar me-1"></i>
        Created: {{ task.createdAtCompact }}
      </small>
      <small class="text-muted d-block">
        <i class="fas fa-clock me-1"></i>
        {{ task.createdAtRelative }}
      </small>
      <small *ngIf="task.isRecent" class="text-success d-block">
        <i class="fas fa-star me-1"></i>
        New task
      </small>
      <small *ngIf="task.age > 30" class="text-warning d-block">
        <i class="fas fa-exclamation-triangle me-1"></i>
        {{ task.age }} days old
      </small>
      <small *ngIf="task.isAssignedToJob" class="text-info d-block">
        <i class="fas fa-link me-1"></i>
        Assigned to job
      </small>
      <small *ngIf="!task.isAssignedToJob" class="text-muted d-block">
        <i class="fas fa-unlock me-1"></i>
        Available for jobs
      </small>
      <small *ngIf="isTaskCompleted()" class="text-success d-block">
        <i class="fas fa-lock me-1"></i>
        Read-only (Completed)
      </small>
    </div>

    <div class="d-flex justify-content-between align-items-center">
      <small class="text-muted">
        <i class="fas fa-fingerprint me-1"></i>
        ID: {{ task.id | slice : 0 : 8 }}...
      </small>

      <div class="btn-group btn-group-sm">
        <button
          class="btn btn-outline-primary btn-sm"
          (click)="onEdit()"
          [title]="canEdit() ? 'Edit task' : isTaskCompleted() ? 'Cannot edit completed task' : 'Cannot edit task assigned to job'"
          [disabled]="!canEdit()"
        >
          <i class="fas fa-edit"></i>
        </button>
        <button
          class="btn btn-outline-info btn-sm"
          (click)="onView()"
          [title]="'View details'"
        >
          <i class="fas fa-eye"></i>
        </button>
        <button
          class="btn btn-outline-danger btn-sm"
          (click)="onDelete()"
          [title]="canDelete() ? 'Delete task' : isTaskCompleted() ? 'Cannot delete completed task' : 'Cannot delete task assigned to job'"
          [disabled]="!canDelete()"
        >
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>
</div>
